<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>三诚库存看板</title>
  
  <!-- 样式表 -->
  <link rel="stylesheet" href="style.css">
  
  <!-- 图标库 -->
  <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js"></script>
  
  <!-- 🔴 重点修复：改回 CDN 链接，确保库能加载 -->
  <!-- Excel 读取库 -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
  <!-- 图表库 -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
</head>
<body>

  <!-- 加载动画层 -->
  <div id="loadingLayer">
    <div class="loader"></div>
    <div class="loading-text">正在同步最新库存数据...</div>
  </div>

  <div class="container">
    <header>
      <div class="header-left">
        <h1><i data-lucide="package-search"></i> 三诚库存看板</h1>
        <div class="update-badge" id="updateTime">检查更新中...</div>
      </div>
    </header>

    <!-- 导航栏 -->
    <div class="tabs">
      <button class="tab active" data-tab="overview">
        <i data-lucide="layout-dashboard"></i> 总览大屏
      </button>
      <button class="tab" data-tab="ranking">
        <i data-lucide="trophy"></i> 库存排行
      </button>
      <button class="tab" data-tab="detail">
        <i data-lucide="search"></i> 明细查询
      </button>
    </div>

    <!-- 1. 总览面板 -->
    <div id="overview" class="panel active">
      <div class="grid">
        <div class="card total">
          <div class="icon-bg"><i data-lucide="boxes"></i></div>
          <div class="num" id="totalStock">0</div>
          <div class="label">总库存件数</div>
        </div>
        <div class="card total">
          <div class="icon-bg"><i data-lucide="file-spreadsheet"></i></div>
          <div class="num" id="totalItems">0</div>
          <div class="label">总SKU数</div>
        </div>
        <div class="card total">
          <div class="icon-bg"><i data-lucide="tags"></i></div>
          <div class="num" id="totalTypes">0</div>
          <div class="label">总型号数</div>
        </div>
        <div class="card total warning">
          <div class="icon-bg"><i data-lucide="alert-triangle"></i></div>
          <div class="num" id="lowStockCount">0</div>
          <div class="label">低库存预警</div>
        </div>
      </div>
      
      <div class="charts-container">
        <div class="chart-box">
          <h3><i data-lucide="pie-chart"></i> 各型号库存占比</h3>
          <div id="pieChart" class="chart-canvas"></div>
        </div>
        <div class="chart-box">
          <h3><i data-lucide="bar-chart-2"></i> 库存 Top 15 规格</h3>
          <div id="barChart" class="chart-canvas"></div>
        </div>
      </div>
    </div>

    <!-- 2. 排行榜面板 -->
    <div id="ranking" class="panel">
      <div class="search-area">
        <div class="input-wrapper">
          <i data-lucide="search" class="search-icon"></i>
          <input type="text" id="searchInput" placeholder="全局搜索：型号 / 规格 / 材质 (支持空格多词搜索)">
        </div>
        <button id="exportBtn" class="btn-action"><i data-lucide="download"></i> 导出CSV</button>
      </div>
      
      <div class="table-header-custom">
        <span>排名</span>
        <span class="col-type">型号</span>
        <span class="col-spec">规格</span>
        <span class="col-mat">材质</span>
        <span>库存</span>
      </div>
      
      <div id="rankingList" class="ranking-list"></div>
    </div>

    <!-- 3. 明细查询面板 -->
    <div id="detail" class="panel">
      <div class="filter-row" style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
        <select id="sheetSelect"></select>
        <span class="count-badge" style="color: #94a3b8; font-size: 0.9em;">共 <span id="itemCount">0</span> 条</span>
      </div>
      
      <div class="search-area">
        <div class="input-wrapper">
          <i data-lucide="filter" class="search-icon"></i>
          <input type="text" id="detailSearch" placeholder="在此型号内筛选...">
        </div>
        <button id="detailExportBtn" class="btn-action secondary"><i data-lucide="file-down"></i> 导出当前</button>
      </div>

      <div class="table-container">
        <table id="detailTable">
          <thead>
            <tr>
              <th>序号</th>
              <th>型号</th>
              <th>规格</th>
              <th>材质</th>
              <th>库存</th>
              <th>单位</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
