<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBER STOCK 2077 V3.4</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="matrix-rain"></div>
    <header>
        <h1>CYBER STOCK 2077</h1>
        <div class="loading" id="loadingMsg">LOADING DATA STREAM... SYSTEM INIT... NEURAL LINK ESTABLISHED</div>
        <div class="controls">
            <input type="file" id="excelUpload" accept=".xlsx,.xls" style="display:none;" onchange="handleFileUpload(event)">
            <button onclick="document.getElementById('excelUpload').click()">从Excel上传数据</button>
            <button onclick="toggleTheme()" id="themeBtn">切换霓虹模式</button>
            <button onclick="showDebugLog()">调试日志</button>
            <div id="progressBar" class="progress" style="display:none;">加载进度: <span id="progress">0%</span></div>
        </div>
    </header>

    <nav class="tabs">
        <button class="tab-btn active" onclick="switchTab('overview')">总览控制台</button>
        <button class="tab-btn" onclick="switchTab('ranking')">物资排行</button>
        <button class="tab-btn" onclick="switchTab('query')">深度查询</button>
    </nav>

    <main>
        <section id="overview" class="tab-content active">
            <div class="metrics-grid">
                <div class="metric-card">Total Stock: <span id="totalStock">0</span></div>
                <div class="metric-card">SKU Count: <span id="skuCount">0</span></div>
                <div class="metric-card">Categories: <span id="categories">0</span></div>
                <div class="metric-card">Critical Low: <span id="criticalLow">0</span></div>
                <div class="metric-card">警报计数: <span id="alertCount">0</span></div>
            </div>
            <div class="dashboard-card">
                <h3>低库存热力图 (Critical Heatmap)</h3>
                <canvas id="heatmapChart"></canvas>
            </div>
            <div class="dashboard-card">
                <h3>库存趋势 (Trend Line)</h3>
                <canvas id="trendChart"></canvas>
            </div>
            <div class="dashboard-card">
                <h3>库存分布雷达 (Distribution Radar)</h3>
                <canvas id="radarChart"></canvas>
            </div>
            <!-- 新增：库存气泡图 -->
            <div class="dashboard-card">
                <h3>库存气泡图 (Bubble Distribution)</h3>
                <canvas id="bubbleChart"></canvas>
            </div>
            <div class="dashboard-card">
                <h3>单位分布饼图 (Unit Pie)</h3>
                <canvas id="pieChart"></canvas>
            </div>
            <div class="dashboard-card">
                <h3>REAL-TIME LOG MONITORING</h3>
                <div id="logMonitor">SYSTEM ONLINE...</div>
            </div>
            <div class="dashboard-card">
                <h3>3D库存球 (Stock Orb)</h3>
                <div id="stockOrb" class="orb-container"></div>
            </div>
        </section>

        <section id="ranking" class="tab-content">
            <div class="dashboard-card">
                <h3>库存 Top 15 (Model + Spec)</h3>
                <table id="inventoryTable">
                    <thead><tr><th>ID</th><th>Model</th><th>Spec</th><th>Mat</th><th>Qty</th><th>Unit</th></tr></thead>
                    <tbody></tbody>
                </table>
                <button onclick="exportCSV()">导出报告 (Export CSV)</button>
            </div>
            <div class="dashboard-card">
                <h3>分类占比 (Category Stack - 3D)</h3>
                <canvas id="stackChart"></canvas>
            </div>
            <div class="dashboard-card">
                <h3>预测热区 (Prediction Heatzone)</h3>
                <canvas id="heatzoneChart"></canvas>
            </div>
        </section>

        <section id="query" class="tab-content">
            <input type="text" id="searchInput" placeholder="搜索 Model/Spec/Qty..." oninput="filterInventory()">
            <div id="queryResults"></div>
            <div class="dashboard-card">
                <h3>库存预测 (Prediction)</h3>
                <button onclick="predictStock()">生成预测</button>
                <div id="predictionOutput"></div>
            </div>
            <!-- 调试日志区 -->
            <div class="dashboard-card" id="debugLog" style="display:none;">
                <h3>调试日志 (Debug Console)</h3>
                <div id="debugOutput"></div>
            </div>
        </section>
    </main>

    <script src="script.js"></script>
</body>
</html>
